<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶¨‡¶∞‡ßç‡¶ß‡¶Æ‡¶æ‡¶® ‡¶¨‡¶á‡¶Æ‡ßá‡¶≤‡¶æ ‡ß®‡ß¶‡ß®‡ß¨ - ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶®‡ßç‡¶∏‡¶° ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root { --primary: #d32f2f; --secondary: #2c3e50; --bg: #f0f2f5; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; }
        body { background: var(--bg); padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border-top: 8px solid var(--primary); }
        .header { text-align: center; margin-bottom: 25px; }
        .header h1 { color: var(--primary); font-size: 24px; margin-bottom: 5px; }
        
        .search-box { display: flex; gap: 10px; margin-bottom: 25px; background: #fff1f1; padding: 15px; border-radius: 8px; }
        input { flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px; }
        .btn-search { background: var(--primary); color: white; border: none; padding: 0 25px; border-radius: 6px; cursor: pointer; font-weight: bold; }

        #result-area { display: none; }
        .section-title { background: var(--secondary); color: white; padding: 8px 15px; border-radius: 4px; margin: 20px 0 10px; font-size: 15px; font-weight: bold; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; }
        .item { background: #f9f9f9; padding: 10px; border: 1px solid #eee; border-radius: 6px; }
        .item span { display: block; font-size: 11px; color: #777; font-weight: bold; text-transform: uppercase; margin-bottom: 3px; }
        .item b { font-size: 14px; color: #222; word-break: break-all; }
        .full { grid-column: 1 / -1; }

        .status-box { text-align: center; margin: 20px 0; padding: 15px; border-radius: 8px; font-size: 18px; font-weight: bold; border: 2px solid #ccc; }
        .Approved { color: #1b5e20; background: #e8f5e9; border-color: #4caf50; }
        .Pending { color: #e65100; background: #fff3e0; border-color: #ff9800; }

        .btn-download { width: 100%; background: var(--secondary); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.3s; }
        .btn-download:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>

<div id="invoice-template" style="display: none; position: absolute; left: -9999px;">
    <div style="width: 800px; padding: 30px; background: white; color: black; font-family: Arial, sans-serif; border: 1px solid #000;">
        <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px;">
            <h1 style="margin: 0; color: #d32f2f;">BURDWAN BOOK FAIR</h1>
            <p>Organised By: <b>Burdwan Avijan Gosthi</b></p>
            <p>49th years, 01-11-2026 To 10-11-2026</b></p>
            <h3>OFFICIAL BOOKING INVOICE</h3>
        </div>

        <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
            <tr>
                <td style="border:1px solid #000; padding:8px;"><b>Form ID:</b> <span id="p_form_id"></span></td>
                <td style="border:1px solid #000; padding:8px;"><b>Date:</b> <span id="p_app_date"></span></td>
            </tr>
            <tr>
                <td colspan="2" style="border:1px solid #000; padding:8px;"><b>Stall Name:</b> <span id="p_stall_name"></span></td>
            </tr>
            <tr>
                <td style="border:1px solid #000; padding:8px;"><b>Proprietor:</b> <span id="p_head_name"></span></td>
                <td style="border:1px solid #000; padding:8px;"><b>Phone:</b> <span id="p_phone"></span></td>
            </tr>
            <tr>
                <td colspan="2" style="border:1px solid #000; padding:8px;"><b>Representative:</b> <span id="p_rep"></span></td>
            </tr>
            <tr>
                <td colspan="2" style="border:1px solid #000; padding:8px;"><b>Address:</b> <span id="p_address"></span></td>
            </tr>
        </table>

        <h4 style="margin-bottom: 5px;">STALL & SERVICE DETAILS</h4>
        <table style="width: 100%; border-collapse: collapse; text-align: center; font-size: 13px;">
            <tr style="background: #f2f2f2;">
                <th style="border:1px solid #000; padding:5px;">Description</th>
                <th style="border:1px solid #000; padding:5px;">Qty/Info</th>
                <th style="border:1px solid #000; padding:5px;">Description</th>
                <th style="border:1px solid #000; padding:5px;">Qty/Info</th>
            </tr>
            <tr>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Specification</td><td style="border:1px solid #000;" id="p_spec"></td>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Area Size</td><td style="border:1px solid #000;" id="p_area"></td>
            </tr>
            <tr>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Rack (8'x6')</td><td style="border:1px solid #000;" id="p_r8"></td>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Extra Table</td><td style="border:1px solid #000;" id="p_tab"></td>
            </tr>
            <tr>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Rack (6'x6')</td><td style="border:1px solid #000;" id="p_r6"></td>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Extra Chair</td><td style="border:1px solid #000;" id="p_chr"></td>
            </tr>
            <tr>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Rack (4'x6')</td><td style="border:1px solid #000;" id="p_r4"></td>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Extra Light</td><td style="border:1px solid #000;" id="p_lgt"></td>
            </tr>
            <tr>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Plug Point</td><td style="border:1px solid #000;" id="p_plg"></td>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Valuation</td><td style="border:1px solid #000;" id="p_val"></td>
            </tr>
            <tr>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Wooden Platform</td><td style="border:1px solid #000;" id="p_plat"></td>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Floor Mat</td><td style="border:1px solid #000;" id="p_mat"></td>
            </tr>
            <tr>
                <td style="border:1px solid #000; padding:5px; text-align:left;">Ad Type</td><td colspan="3" style="border:1px solid #000;" id="p_ad_type"></td>
            </tr>
        </table>

        <div style="margin-top: 20px; float: right; width: 300px;">
            <table style="width: 100%; border-collapse: collapse;">
                <tr><td style="padding:5px; border:1px solid #000;">Grand Total:</td><td style="padding:5px; border:1px solid #000;" id="p_g_tot"></td></tr>
		<tr><td style="padding:5px; border:1px solid #000;">Ad Price:</td><td style="padding:5px; border:1px solid #000;" id="p_ad_price"></td></tr>
                <tr><td style="padding:5px; border:1px solid #000;">Total Bill:</td><td style="padding:5px; border:1px solid #000;" id="p_total_bill"></td></tr>
                <tr style="color: green;"><td style="padding:5px; border:1px solid #000;">Paid Advance:</td><td style="padding:5px; border:1px solid #000;" id="p_paid"></td></tr>
                <tr style="color: red;"><td style="padding:5px; border:1px solid #000;"><b>Due Balance:</b></td><td style="padding:5px; border:1px solid #000;" id="p_due"></td></tr>
            </table>
        </div>

        <div style="clear: both; margin-top: 30px; font-size: 11px;">
            <p><b>Transaction ID:</b> <span id="p_trx"></span> | <b>Trx Date:</b> <span id="p_trx_date"></span></p>
            <p style="text-align: center; margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 10px;">
                This is a computer generated document. Generated on: <span id="p_gen_time"></span>
            </p>
        </div>
    </div>
</div>

<div class="container">
    <div class="card">
        <div class="header">
            <h1>‡¶¨‡¶∞‡ßç‡¶ß‡¶Æ‡¶æ‡¶® ‡¶¨‡¶á‡¶Æ‡ßá‡¶≤‡¶æ</h1>
            <p>‡¶Ö‡¶´‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤</p>
        </div>

        <div class="search-box">
            <input type="text" id="bookingID" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Form ID ‡¶¶‡¶ø‡¶® (‡¶â‡¶¶‡¶æ‡¶É BF26-1001)">
            <button class="btn-search" onclick="searchBooking()">‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        </div>

        <div id="result-area">
            <div class="section-title">‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶ì ‡¶∏‡ßç‡¶ü‡¶≤‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</div>
            <div class="grid">
                <div class="item"><span>Application Date</span><b id="r_app_date"></b></div>
                <div class="item"><span>Form ID</span><b id="r_form_id"></b></div>
                <div class="item full"><span>Stall Name</span><b id="r_stall_name"></b></div>
                <div class="item"><span>Proprietor Name</span><b id="r_head_name"></b></div>
                <div class="item"><span>Phone</span><b id="r_phone"></b></div>
                <div class="item full"><span>Address</span><b id="r_address"></b></div>
                <div class="item"><span>Representative</span><b id="r_rep"></b></div>
            </div>

            <div class="section-title">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶ì ‡¶∏‡ßá‡¶¨‡¶æ</div>
            <div class="grid">
                <div class="item"><span>Specification</span><b id="r_spec"></b></div>
                <div class="item"><span>Area (sqft)</span><b id="r_area"></b></div>
                <div class="item"><span>Rack 8'x6'</span><b id="r_r8"></b></div>
                <div class="item"><span>Rack 6'x6'</span><b id="r_r6"></b></div>
                <div class="item"><span>Rack 4'x6'</span><b id="r_r4"></b></div>
                <div class="item"><span>Extra Table</span><b id="r_tab"></b></div>
                <div class="item"><span>Extra Chair</span><b id="r_chr"></b></div>
                <div class="item"><span>Extra Light</span><b id="r_lgt"></b></div>
                <div class="item"><span>Extra Plug</span><b id="r_plg"></b></div>
                <div class="item"><span>Platform</span><b id="r_plat"></b></div>
                <div class="item"><span>Floor Mat</span><b id="r_mat"></b></div>
                <div class="item"><span>Valuation</span><b id="r_val"></b></div>
            </div>

            <div class="section-title">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</div>
            <div class="grid">
                <div class="item"><span>Grand Total</span><b id="r_g_tot"></b></div>
                <div class="item"><span>Ad Type</span><b id="r_ad_type"></b></div>
                <div class="item"><span>Total Bill</span><b id="r_total_bill"></b></div>
                <div class="item"><span>Advance Paid</span><b id="r_paid"></b></div>
                <div class="item"><span>Due Bill</span><b id="r_due"></b></div>
                <div class="item"><span>Trx ID</span><b id="r_trx"></b></div>
                <div class="item"><span>Trx Date</span><b id="r_trx_date"></b></div>
            </div>

            <div id="status_label" class="status-box"></div>
            <button class="btn-download" id="downloadBtn" onclick="generatePDF()" disabled>üì• ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶∞‡¶∏‡¶ø‡¶¶ (PDF)</button>
        </div>
    </div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzs6ZpiHzT2FIqfZqlA4AlQjqtoWQZgivd9oNJNPL9oCpp69-Av0QEH3i8Ic30Oq_MLUQ/exec';
    let d = null;

    async function searchBooking() {
        const id = document.getElementById('bookingID').value.trim();
        if(!id) return alert("‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®");
        document.querySelector('.btn-search').innerText = "‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
        try {
            const res = await fetch(`${scriptURL}?search_id=${id}`);
            d = await res.json();
            if(d.status === "error") {
                alert("‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!");
                document.getElementById('result-area').style.display = 'none';
            } else {
                displayResults();
            }
        } catch(e) { alert("‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø!"); }
        document.querySelector('.btn-search').innerText = "‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®";
    }

    function displayResults() {
        // ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ)
        document.getElementById('r_app_date').innerText = d.application_date || "";
        document.getElementById('r_form_id').innerText = d.form_id || "";
        document.getElementById('r_stall_name').innerText = d.stall_name || "";
        document.getElementById('r_head_name').innerText = d.head_name || "";
        document.getElementById('r_address').innerText = d.address || "";
        document.getElementById('r_phone').innerText = d.proprietor_phone || "";
        document.getElementById('r_rep').innerText = d.represent_name || "";
        document.getElementById('r_spec').innerText = d.specification || "";
        document.getElementById('r_area').innerText = d.area_size || "0";
        document.getElementById('r_r8').innerText = d.extra_rack_8x6 || 0;
        document.getElementById('r_r6').innerText = d.extra_rack_6x6 || 0;
        document.getElementById('r_r4').innerText = d.extra_rack_4x6 || 0;
        document.getElementById('r_tab').innerText = d.extra_table || 0;
        document.getElementById('r_chr').innerText = d.extra_chair || 0;
        document.getElementById('r_lgt').innerText = d.extra_light || 0;
        document.getElementById('r_plg').innerText = d.extra_plug || 0;
        document.getElementById('r_plat').innerText = d.extra_platform || "No";
        document.getElementById('r_mat').innerText = d.extra_mat || "No";
        document.getElementById('r_val').innerText = d.valuation || "0";
        document.getElementById('r_g_tot').innerText = "‚Çπ" + (d.grand_total || 0);
        document.getElementById('r_ad_type').innerText = d.ad_type || "N/A";
        document.getElementById('r_total_bill').innerText = "‚Çπ" + (d.total_bill || 0);
        document.getElementById('r_paid').innerText = "‚Çπ" + (d.advance_pay || 0);
        document.getElementById('r_due').innerText = "‚Çπ" + (d.due_bill || 0);
        document.getElementById('r_trx').innerText = d.trx_id || "N/A";
        document.getElementById('r_trx_date').innerText = d.trx_date || "N/A";

        const s = document.getElementById('status_label');
        const status = d.booking_status || "Pending";
        s.innerText = "‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏: " + status;
        s.className = "status-box " + (status === "Approved" ? "Approved" : "Pending");
        
        const btn = document.getElementById('downloadBtn');
        if(status === "Approved") {
            btn.disabled = false;
            btn.innerText = "üì• ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶∞‡¶∏‡¶ø‡¶¶ (PDF)";
        } else {
            btn.disabled = true;
            btn.innerText = "‚ùå ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶®‡¶Ø‡¶º";
        }
        document.getElementById('result-area').style.display = 'block';
    }

    async function generatePDF() {
        if (!d || d.booking_status !== "Approved") return;
        const btn = document.getElementById('downloadBtn');
        btn.innerText = "PDF ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
        btn.disabled = true;

        // PDF ‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü‡ßá ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
        document.getElementById('p_app_date').innerText = d.application_date || "";
        document.getElementById('p_form_id').innerText = d.form_id || "";
        document.getElementById('p_stall_name').innerText = d.stall_name || "";
        document.getElementById('p_head_name').innerText = d.head_name || "";
        document.getElementById('p_address').innerText = d.address || "";
        document.getElementById('p_phone').innerText = d.proprietor_phone || "";
        document.getElementById('p_rep').innerText = d.represent_name || "";
        document.getElementById('p_spec').innerText = d.specification || "";
        document.getElementById('p_area').innerText = (d.area_size || "0") + " sqft";
        document.getElementById('p_r8').innerText = d.extra_rack_8x6 || 0;
        document.getElementById('p_r6').innerText = d.extra_rack_6x6 || 0;
        document.getElementById('p_r4').innerText = d.extra_rack_4x6 || 0;
        document.getElementById('p_tab').innerText = d.extra_table || 0;
        document.getElementById('p_chr').innerText = d.extra_chair || 0;
        document.getElementById('p_lgt').innerText = d.extra_light || 0;
        document.getElementById('p_plg').innerText = d.extra_plug || 0;
        document.getElementById('p_plat').innerText = d.extra_platform || "No";
        document.getElementById('p_mat').innerText = d.extra_mat || "No";
        document.getElementById('p_val').innerText = d.valuation || "0";
        document.getElementById('p_ad_type').innerText = d.ad_type || "N/A";
        document.getElementById('p_g_tot').innerText = "‚Çπ" + (d.grand_total || 0);
	document.getElementById('p_ad_price').innerText = "‚Çπ" + (d.ad_price || 0);
        document.getElementById('p_total_bill').innerText = "‚Çπ" + (d.total_bill || 0);
        document.getElementById('p_paid').innerText = "‚Çπ" + (d.advance_pay || 0);
        document.getElementById('p_due').innerText = "‚Çπ" + (d.due_bill || 0);
        document.getElementById('p_trx').innerText = d.trx_id || "N/A";
        document.getElementById('p_trx_date').innerText = d.trx_date || "N/A";
        document.getElementById('p_gen_time').innerText = new Date().toLocaleString();

        const element = document.getElementById('invoice-template');
        element.style.display = 'block';

        try {
            const canvas = await html2canvas(element.querySelector('div'), { scale: 2 });
            const imgData = canvas.toDataURL('image/png');
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            doc.addImage(imgData, 'PNG', 10, 10, 190, 0);
            doc.save(`Invoice_${d.form_id}.pdf`);
        } catch (e) {
            alert("Error generating PDF");
        } finally {
            element.style.display = 'none';
            btn.innerText = "üì• ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶∞‡¶∏‡¶ø‡¶¶ (PDF)";
            btn.disabled = false;
        }
    }
</script>
</body>
</html>